services:
  whisper:
    build: .
    image: whisper-rocm
    container_name: whisper-ai-rocm
    # No 'command' needed; it will use the Dockerfile ENTRYPOINT
    user: "${UID}:${GID}"
    volumes:
      - .:/app
      - ${HOME}:${HOME}
      # Mounts a local 'models' folder to the container's whisper cache
      - ./models:${HOME}/.cache/whisper
    working_dir: ${HOME}
    devices:
      - /dev/kfd:/dev/kfd
      - /dev/dri:/dev/dri
    security_opt:
      - seccomp:unconfined
    group_add:
      - video
      - render
    ipc: host
    shm_size: 8G
    environment:
      - HSA_OVERRIDE_GFX_VERSION=${HSA_OVERRIDE_GFX_VERSION}
      - HOME=${HOME}
